# 단위 테스트

## TDD 법칙 3가지

### 첫째 법칙

- 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.

### 둘째 법칙

- 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.

### 셋째 법칙

- 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

## 깨끗한 테스트 코드 유지하기

- 실제 코드가 진화하면 테스트 코드도 변해야 한다
- 테스트 슈트가 없으면 개발자는 자신이 수정한 코드가 제대로 동작하는지 확인할 방법이 없다.
결국 결함이 많아지기 시작하면서 나중에가면 개발자는 변경을 주저한다.
- 그러므로 테스트 코드는 실제 코드 못지 않게 중요하며, 실제 코드와 마찬가지로 깨끗하게 짜야 한다.

## 테스트는 유연성, 유지보수성, 재사용성을 제공한다.

- 코드에 유연성, 유지보수성, 재사용성을 제공하는 버팀목은 단위 테스트이다.
- 아키텍처가 아무리 유연하며, 설계를 잘해도 테스트 케이스가 없으면 개발자는 버그가 숨어있을까 변경을 주저한다.
하지만 테스트 케이스가 있다면 아키텍처가 부실한 코드나 설계가 모호하고 엉망인 코드라도 개선할 수 있다.
- 그러므로 실제 코드를 점검하는 자동화된 단위 테스트 슈트는 설계와 아키텍처를 최대한 깨끗하게 보존하는 열쇠이다.
테스트는 유연성, 유지보수성, 재사용성을 제공한다.
테스트 케이스가 있으면 변경이 쉬워지기 때문이다.
- 따라서 테스트 코드가 지저분하면 코드를 변경하는 능력이 떨어지며 코드 구조를 개선하는 능력도 떨어진다.
테스트 코드가 지저분할 수록 실제 코드도 지저분해진다.
결국 테스트 코드를 잃어버리고 실제 코드도 망가진다.

## 깨끗한 테스트 코드

- 깨끗한 테스트 코드를 만들기 위해서는 3가지가 필요하다.
가독성, 가독성, 가독성
- 테스트 코드에서 가독성을 높이려면 명료성, 단순성, 풍부한 표현력이 필요하다.
- 각 테스트는 명확히 3부분으로 나눠진다.
첫째, 테스트 자료를 만든다.
둘째, 테스트 자료를 조작한다.
셋째, 조작한 결과가 올바른지 확인한다.
- 테스트 코드는 본론에 돌입해 진짜 필요한 자료 유형과 함수만 사용하므로 코드를 읽는 사람은 온갖 잡다하고 세세한 코드에 주눅들고 헷갈릴 필요 없이 코드가 수행하는 기능을 재빨리 이해한다.

## 이중 표준

```java
@Test
public void turnOnLoTempAlarmThreashold() throws Exception {
	hw.setTemp(WAY_TOO_COLD);
	controller.tic();
	assertTrue(hw.heaterState());
	assertTrue(hw.blowerState());
	assertTrue(hw.coolerState());
	assertFalse(hw.hiTempAlarm());
	assertTrue(hw.loTempAlarm());
}
```

- 위 코드는 테스트 코드를 읽기 어려우므로 수정한다.

```java
@Test
public void turnOnLoTempAlarmThreashold() throws Exception {
	wayTooCold();
	assertEquals("HBchL", hw.getState());
}
```

- 위 처럼 `wayTooCold` 라는 함수를 만들어 숨겼다.

## F.I.R.S.T

- 깨끗한 테스트는 다음 5가지 규칙을 따르는데, 각 규칙에서 첫 글자를 따온 부분이다.

1. Fast (빠르게)
    - 테스트는 빨라야 한다.
    - 자주 돌리지 않고 초반에 문제를 찾아내지 못하면 결국 코드 품질이 망가지기 시작한다.

1. Independent (독립적으로)
    - 각 테스트는 서로 의존하면 안 된다.
    - 각 테스트는 독립적으로 그리고 어떤 순서로 실행해도 괜찮아야 한다.
    테스트가 서로에게 의존하면 하나가 실패할 때 나머지도 잇달아 실패하므로 원인을 진단하기 어려워지며 후반 테스트가 찾아내야 할 결함이 숨겨진다.

1. Repeatable (반복가능하게)
    - 테스트는 어떤 환경에서도 반복 가능해야 한다.
    - 실제 환경, QA, 버스를 타고 집 가는 길에도 사용하는 노트북 환경에서도 사용할 수 있어야 한다.

1. Self-Validating (자가검증하는)
    - 테스트는 부울 값으로 결과를 내야 한다.
    - 성공 아니면 실패다.
    - 통과 여부를 보려고 텍스트 파일 두 개를 작업으로 비교하게 만들어서도 안 된다.

1. Timely (적시에)
    - 테스트는 적시에 작성해야 한다.
    - 단위 테스트는 실제 코드를 구현하기 직전에 구현한다.
    - 실제 코드를 구현한 다음에 테스트 코드를 만들면 실제 코드가 테스트하기 어렵다는 사실을 발견할지도 모른다.

## 결론

- 테스트 코드는 실제 코드처럼 프로젝트 건강에 중요하다.
어쩌면 실제 코드보다 더 중요할지도 모른다.
- 테스트 코드는 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화하기 때문이다.
- 그러므로 테스트 코드는 지속적으로 깨끗하게 관리하고 표현력을 높이고 간결하게 정리하자
- 테스트 코드가 방치되어 망가지면 실제 코드도 망가지기에 테스트 코드를 깨끗하게 유지하자
