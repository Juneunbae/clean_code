## 클린 코드 설계를 위한 깔끔한 경계 처리 기법

- 나만의 소프트웨어를 개발할 때, 내가 만든 컴포넌트만 사용하는 것이 아니라 외부 컴포넌트를 사용하는 경우도 반드시 존재한다. 이때 이 **외부 코드를 우리 코드에 깔끔하게 통합**해야 한다.
- 외부 API를 내부 로직에 적절한 경계를 두지 않고 사용하게 된다면 가독성과 유지보수성 모두 떨어지게 된다.

---

## 경계 인터페이스란?

- 전체 소프트웨어 개발에 사용하게 되는 외부 코드를 내 코드에서 호출하는 부분

![경계인터페이스.png](경계인터페이스.png)

### 현실 예시

1. 한 레스토랑에 손님과 주방, 그리고 서빙하는 웨이터가 있다.
2. 손님은 메뉴판에 존재하는 메뉴를 선택해 웨이터에게 요청한다.
3. 웨이터는 주방에 요청을 전달하고 주방에서는 정해진 메뉴 중 손님이 요청한 메뉴를 응답한다.

   ※ 이때 손님은 요리에 대해서 A 재료를 넣고, B 재료를 넣고 … 이러한 주방 사정을 알 필요가 없다.


### 소프트웨어 예시

1. 센서 정보 구성 클래스(Sensor)는 센서들을 관리하는 객체이다.
2. 센서 정보를 조회하는 로직(Client)에서는 센서를 ID로 조회하기 위해 Sensor.getById(”2FDSF”)를 호출한다.
3. Sensor는 내부적으로 Map을 갖고 있으며, 해당 ID에 맞는 센서를 찾아 반환한다.
4. 클라이언트는 Sensor 객체만 받아서 사용하고, Map이나 저장 방식은 알 필요가 없다.
- 손님 = Client = 내부 로직
- 웨이터 = Sensor = 경계 인터페이스
- 주방 = Map = 외부 API or 구조

---

## 경계 코드 이해하기

- 외부에서 가져오는 패키지에 대해서 명확하게 알지 못하고 가져와서 적용하게 된다면 어떠한 문제가 발생하였을 때 원인 추적이 어렵고 통합에도 어려움을 겪을 수 있다.

### 학습 테스트

- 이를 해결하기 위해 우리쪽 코드를 작성해 외부 코드를 호출하는 대신 이 **외부 코드의 동작을 하는 간단한 테스트 케이스**를 작성해 학습하는 방법이 있다.
- 통제된 환경에서 사용하고자 하는 외부 API를 제대로 이해하는지 확인하기 위한 목적으로 사용된다.
- 이러한 행위는 외부 패키지의 코드를 변경해서 사용해야 하는 경우나 새 버전이 나올 때 발생할 수 있는 위험에 대응할 수 있다.

### 아는 코드와 모르는 코드를 분리하는 경계 코드

- 외부 라이브러리나 API처럼 내부 구현을 완전히 알 수 없는 코드 와 직접 맞물리지 않기 위해, 그들과의 경계에 인터페이스를 정의한다.
- 개발하고자 하는 기능에 초점을 맞추어 인터페이스를 구성한다.
- 비즈니스 로직과 인터페이스를 분리하고 해당 인터페이스를 구현한 구현체가 외부 API와 통신하는 구조를 채택한다. (ADAPTER 패턴)
- 이러한 구조를 활용하게 된다면 경계 테스트 케이스를 생성해 외부 API 를 정상적으로 사용하고 있는지 테스트도 가능하다.

## 정리

- 정리하자면, 깨끗한 경계를 만드는 것이 중요하다.
- 변경이 일어나는 경우에는 이러한 경계에 대한 정의가 명확하다면 내부 로직에서는 외부 API에 대해 알지 못해도(크게 수정하지 않아도) 정상적으로 작동 가능하다.
- 이는 우리가 통제가 불가능한 외부 패키지를 통제 가능한 영역으로 만드는 것을 의미한다.
- 새로운 클래스로 경계를 감싸거나(일급 컬렉션), ADAPTER 패턴을 사용하면 경계 인터페이스를 사용하는 일관성도 높아지며, 외부 패키지가 변했을 때 변경할 코드도 줄어든다.